# API CRUD de Usuários

API completa para cadastro, autenticação e gerenciamento de usuários com Node.js, Express e PostgreSQL.

## 🚀 Funcionalidades

- ✅ Cadastro de usuários com validações
- ✅ Login com JWT
- ✅ CRUD completo de usuários
- ✅ Middleware de autenticação
- ✅ Validações robustas
- ✅ Rate limiting
- ✅ Segurança com Helmet
- ✅ Soft delete
- ✅ Paginação
- ✅ Hash de senhas com bcrypt

## 📋 Pré-requisitos

- Node.js (versão 16 ou superior)
- PostgreSQL
- npm ou yarn

## 🛠️ Instalação

1. **Clone o repositório e navegue até a pasta Backend:**
```bash
cd Backend
```

2. **Instale as dependências:**
```bash
npm install
```

3. **Configure as variáveis de ambiente:**
```bash
cp env.example .env
```

4. **Edite o arquivo `.env` com suas configurações:**
```env
# Configurações do Banco de Dados
DB_HOST=localhost
DB_PORT=5432
DB_NAME=usuarios_db
DB_USER=postgres
DB_PASSWORD=sua_senha_aqui

# Configurações JWT
JWT_SECRET=seu_jwt_secret_muito_seguro_aqui
JWT_EXPIRES_IN=24h

# Configurações do Servidor
PORT=3000
NODE_ENV=development
```

5. **Execute o script SQL no seu banco PostgreSQL:**
```sql
DROP TABLE IF EXISTS usuario;

CREATE TABLE usuario (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome TEXT NOT NULL,
  pronome TEXT,
  senha TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  telefone TEXT,
  data_nascimento DATE,
  cpf TEXT UNIQUE,
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  active BOOLEAN DEFAULT TRUE,
  deleteAt TIMESTAMP WITH TIME ZONE,
  deleteBy BIGINT
);
```

6. **Inicie o servidor:**
```bash
# Desenvolvimento
npm run dev

# Produção
npm start
```

## 📚 Endpoints da API

### 🔐 Autenticação (`/api/auth`)

| Método | Endpoint | Descrição | Autenticação |
|--------|----------|-----------|--------------|
| POST | `/register` | Cadastrar usuário | ❌ |
| POST | `/login` | Login | ❌ |
| POST | `/refresh-token` | Renovar token | ❌ |
| POST | `/logout` | Logout | ✅ |
| POST | `/change-password` | Alterar senha | ✅ |
| POST | `/reset-password` | Reset de senha | ❌ |

### 👥 Usuários (`/api/usuarios`)

| Método | Endpoint | Descrição | Autenticação |
|--------|----------|-----------|--------------|
| GET | `/` | Listar usuários (paginado) | ✅ |
| GET | `/profile` | Perfil do usuário logado | ✅ |
| GET | `/:id` | Buscar usuário por ID | ✅ |
| GET | `/email/:email` | Buscar usuário por email | ✅ |
| PUT | `/profile` | Atualizar perfil | ✅ |
| PUT | `/:id` | Atualizar usuário | ✅ |
| DELETE | `/:id` | Remover usuário (soft delete) | ✅ |

## 🔧 Exemplos de Uso

### Cadastro de Usuário
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "nome": "João Silva",
    "pronome": "ele/dele",
    "email": "joao@exemplo.com",
    "senha": "MinhaSenh@123",
    "telefone": "(11) 99999-9999",
    "data_nascimento": "1990-05-15",
    "cpf": "123.456.789-00"
  }'
```

### Login
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "joao@exemplo.com",
    "senha": "MinhaSenh@123"
  }'
```

### Buscar Perfil (com token)
```bash
curl -X GET http://localhost:3000/api/usuarios/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

### Listar Usuários (paginado)
```bash
curl -X GET "http://localhost:3000/api/usuarios?page=1&limit=10" \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

## 🔒 Segurança

- **Hash de senhas**: bcrypt com salt rounds 12
- **JWT**: Tokens seguros com expiração
- **Rate limiting**: Proteção contra ataques de força bruta
- **Helmet**: Headers de segurança
- **CORS**: Configuração de origem permitida
- **Validações**: Validação robusta de dados de entrada
- **Soft delete**: Dados não são removidos permanentemente

## 📊 Validações

### Cadastro
- Nome: obrigatório, 2-100 caracteres
- Email: formato válido, único
- Senha: mínimo 6 caracteres, deve conter maiúscula, minúscula e número
- Telefone: formato válido (opcional)
- Data de nascimento: formato ISO, idade mínima 13 anos (opcional)
- CPF: formato e validação de dígitos (opcional)

### Login
- Email: formato válido
- Senha: obrigatória

## 🚦 Status Codes

- `200` - Sucesso
- `201` - Criado com sucesso
- `400` - Dados inválidos
- `401` - Não autorizado
- `403` - Acesso negado
- `404` - Não encontrado
- `409` - Conflito (email/CPF já existe)
- `429` - Muitas tentativas
- `500` - Erro interno do servidor

## 🧪 Testes

```bash
npm test
```

## 📝 Logs

O servidor registra todas as requisições com timestamp, método, path e IP do cliente.

## 🔧 Desenvolvimento

Para desenvolvimento, use:
```bash
npm run dev
```

Isso iniciará o servidor com nodemon para reinicialização automática.

## 📦 Estrutura do Projeto

```
Backend/
├── src/
│   ├── config/
│   │   └── database.js
│   ├── controllers/
│   │   ├── authController.js
│   │   └── usuarioController.js
│   ├── middleware/
│   │   └── auth.js
│   ├── models/
│   │   └── Usuario.js
│   ├── routes/
│   │   ├── auth.js
│   │   └── usuarios.js
│   ├── services/
│   │   └── authService.js
│   ├── validators/
│   │   └── usuarioValidator.js
│   └── server.js
├── package.json
├── env.example
└── README.md
```

## 🤝 Contribuição

1. Faça um fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudanças (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## 📄 Licença

Este projeto está sob a licença MIT. Veja o arquivo `LICENSE` para mais detalhes.
