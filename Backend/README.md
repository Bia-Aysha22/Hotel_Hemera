# API CRUD de UsuÃ¡rios

API completa para cadastro, autenticaÃ§Ã£o e gerenciamento de usuÃ¡rios com Node.js, Express e PostgreSQL.

## ğŸš€ Funcionalidades

- âœ… Cadastro de usuÃ¡rios com validaÃ§Ãµes
- âœ… Login com JWT
- âœ… CRUD completo de usuÃ¡rios
- âœ… Middleware de autenticaÃ§Ã£o
- âœ… ValidaÃ§Ãµes robustas
- âœ… Rate limiting
- âœ… SeguranÃ§a com Helmet
- âœ… Soft delete
- âœ… PaginaÃ§Ã£o
- âœ… Hash de senhas com bcrypt

## ğŸ“‹ PrÃ©-requisitos

- Node.js (versÃ£o 16 ou superior)
- PostgreSQL
- npm ou yarn

## ğŸ› ï¸ InstalaÃ§Ã£o

1. **Clone o repositÃ³rio e navegue atÃ© a pasta Backend:**
```bash
cd Backend
```

2. **Instale as dependÃªncias:**
```bash
npm install
```

3. **Configure as variÃ¡veis de ambiente:**
```bash
cp env.example .env
```

4. **Edite o arquivo `.env` com suas configuraÃ§Ãµes:**
```env
# ConfiguraÃ§Ãµes do Banco de Dados
DB_HOST=localhost
DB_PORT=5432
DB_NAME=usuarios_db
DB_USER=postgres
DB_PASSWORD=sua_senha_aqui

# ConfiguraÃ§Ãµes JWT
JWT_SECRET=seu_jwt_secret_muito_seguro_aqui
JWT_EXPIRES_IN=24h

# ConfiguraÃ§Ãµes do Servidor
PORT=3000
NODE_ENV=development
```

5. **Execute o script SQL no seu banco PostgreSQL:**
```sql
DROP TABLE IF EXISTS usuario;

CREATE TABLE usuario (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome TEXT NOT NULL,
  pronome TEXT,
  senha TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  telefone TEXT,
  data_nascimento DATE,
  cpf TEXT UNIQUE,
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  active BOOLEAN DEFAULT TRUE,
  deleteAt TIMESTAMP WITH TIME ZONE,
  deleteBy BIGINT
);
```

6. **Inicie o servidor:**
```bash
# Desenvolvimento
npm run dev

# ProduÃ§Ã£o
npm start
```

## ğŸ“š Endpoints da API

### ğŸ” AutenticaÃ§Ã£o (`/api/auth`)

| MÃ©todo | Endpoint | DescriÃ§Ã£o | AutenticaÃ§Ã£o |
|--------|----------|-----------|--------------|
| POST | `/register` | Cadastrar usuÃ¡rio | âŒ |
| POST | `/login` | Login | âŒ |
| POST | `/refresh-token` | Renovar token | âŒ |
| POST | `/logout` | Logout | âœ… |
| POST | `/change-password` | Alterar senha | âœ… |
| POST | `/reset-password` | Reset de senha | âŒ |

### ğŸ‘¥ UsuÃ¡rios (`/api/usuarios`)

| MÃ©todo | Endpoint | DescriÃ§Ã£o | AutenticaÃ§Ã£o |
|--------|----------|-----------|--------------|
| GET | `/` | Listar usuÃ¡rios (paginado) | âœ… |
| GET | `/profile` | Perfil do usuÃ¡rio logado | âœ… |
| GET | `/:id` | Buscar usuÃ¡rio por ID | âœ… |
| GET | `/email/:email` | Buscar usuÃ¡rio por email | âœ… |
| PUT | `/profile` | Atualizar perfil | âœ… |
| PUT | `/:id` | Atualizar usuÃ¡rio | âœ… |
| DELETE | `/:id` | Remover usuÃ¡rio (soft delete) | âœ… |

## ğŸ”§ Exemplos de Uso

### Cadastro de UsuÃ¡rio
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "nome": "JoÃ£o Silva",
    "pronome": "ele/dele",
    "email": "joao@exemplo.com",
    "senha": "MinhaSenh@123",
    "telefone": "(11) 99999-9999",
    "data_nascimento": "1990-05-15",
    "cpf": "123.456.789-00"
  }'
```

### Login
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "joao@exemplo.com",
    "senha": "MinhaSenh@123"
  }'
```

### Buscar Perfil (com token)
```bash
curl -X GET http://localhost:3000/api/usuarios/profile \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

### Listar UsuÃ¡rios (paginado)
```bash
curl -X GET "http://localhost:3000/api/usuarios?page=1&limit=10" \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

## ğŸ”’ SeguranÃ§a

- **Hash de senhas**: bcrypt com salt rounds 12
- **JWT**: Tokens seguros com expiraÃ§Ã£o
- **Rate limiting**: ProteÃ§Ã£o contra ataques de forÃ§a bruta
- **Helmet**: Headers de seguranÃ§a
- **CORS**: ConfiguraÃ§Ã£o de origem permitida
- **ValidaÃ§Ãµes**: ValidaÃ§Ã£o robusta de dados de entrada
- **Soft delete**: Dados nÃ£o sÃ£o removidos permanentemente

## ğŸ“Š ValidaÃ§Ãµes

### Cadastro
- Nome: obrigatÃ³rio, 2-100 caracteres
- Email: formato vÃ¡lido, Ãºnico
- Senha: mÃ­nimo 6 caracteres, deve conter maiÃºscula, minÃºscula e nÃºmero
- Telefone: formato vÃ¡lido (opcional)
- Data de nascimento: formato ISO, idade mÃ­nima 13 anos (opcional)
- CPF: formato e validaÃ§Ã£o de dÃ­gitos (opcional)

### Login
- Email: formato vÃ¡lido
- Senha: obrigatÃ³ria

## ğŸš¦ Status Codes

- `200` - Sucesso
- `201` - Criado com sucesso
- `400` - Dados invÃ¡lidos
- `401` - NÃ£o autorizado
- `403` - Acesso negado
- `404` - NÃ£o encontrado
- `409` - Conflito (email/CPF jÃ¡ existe)
- `429` - Muitas tentativas
- `500` - Erro interno do servidor

## ğŸ§ª Testes

```bash
npm test
```

## ğŸ“ Logs

O servidor registra todas as requisiÃ§Ãµes com timestamp, mÃ©todo, path e IP do cliente.

## ğŸ”§ Desenvolvimento

Para desenvolvimento, use:
```bash
npm run dev
```

Isso iniciarÃ¡ o servidor com nodemon para reinicializaÃ§Ã£o automÃ¡tica.

## ğŸ“¦ Estrutura do Projeto

```
Backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ database.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â””â”€â”€ usuarioController.js
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ auth.js
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ Usuario.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â””â”€â”€ usuarios.js
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ authService.js
â”‚   â”œâ”€â”€ validators/
â”‚   â”‚   â””â”€â”€ usuarioValidator.js
â”‚   â””â”€â”€ server.js
â”œâ”€â”€ package.json
â”œâ”€â”€ env.example
â””â”€â”€ README.md
```

## ğŸ¤ ContribuiÃ§Ã£o

1. FaÃ§a um fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a MIT. Veja o arquivo `LICENSE` para mais detalhes.
